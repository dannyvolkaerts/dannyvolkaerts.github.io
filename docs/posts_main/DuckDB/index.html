<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Danny Volkaerts">
<meta name="dcterms.date" content="2025-05-07">
<meta name="description" content="A comprehensive guide to DuckDB: an analytical database designed for seamless data analysis with Python">

<title>Introduction to DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts_main.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../courses.html"> 
<span class="menu-text">Courses</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-duckdb" id="toc-introduction-to-duckdb" class="nav-link active" data-scroll-target="#introduction-to-duckdb">Introduction to DuckDB</a>
  <ul class="collapse">
  <li><a href="#what-is-duckdb" id="toc-what-is-duckdb" class="nav-link" data-scroll-target="#what-is-duckdb">What is DuckDB?</a></li>
  <li><a href="#what-makes-duckdb-exceptional" id="toc-what-makes-duckdb-exceptional" class="nav-link" data-scroll-target="#what-makes-duckdb-exceptional">What Makes DuckDB Exceptional?</a>
  <ul class="collapse">
  <li><a href="#comprehensive-data-ingestion-and-direct-querying-capabilities" id="toc-comprehensive-data-ingestion-and-direct-querying-capabilities" class="nav-link" data-scroll-target="#comprehensive-data-ingestion-and-direct-querying-capabilities">Comprehensive Data Ingestion and Direct Querying Capabilities</a></li>
  <li><a href="#seamless-integration-with-python-data-structures" id="toc-seamless-integration-with-python-data-structures" class="nav-link" data-scroll-target="#seamless-integration-with-python-data-structures">Seamless Integration with Python Data Structures</a></li>
  <li><a href="#efficient-result-conversion-and-interoperability" id="toc-efficient-result-conversion-and-interoperability" class="nav-link" data-scroll-target="#efficient-result-conversion-and-interoperability">Efficient Result Conversion and Interoperability</a></li>
  <li><a href="#flexible-storage-architecture" id="toc-flexible-storage-architecture" class="nav-link" data-scroll-target="#flexible-storage-architecture">Flexible Storage Architecture</a></li>
  <li><a href="#advanced-data-export-capabilities" id="toc-advanced-data-export-capabilities" class="nav-link" data-scroll-target="#advanced-data-export-capabilities">Advanced Data Export Capabilities</a></li>
  <li><a href="#developer-friendly-api-design" id="toc-developer-friendly-api-design" class="nav-link" data-scroll-target="#developer-friendly-api-design">Developer-Friendly API Design</a></li>
  <li><a href="#extensible-architecture" id="toc-extensible-architecture" class="nav-link" data-scroll-target="#extensible-architecture">Extensible Architecture</a></li>
  <li><a href="#optimized-query-execution" id="toc-optimized-query-execution" class="nav-link" data-scroll-target="#optimized-query-execution">Optimized Query Execution</a></li>
  </ul></li>
  <li><a href="#practical-example-analyzing-the-titanic-dataset-with-duckdb-and-kaggle-api" id="toc-practical-example-analyzing-the-titanic-dataset-with-duckdb-and-kaggle-api" class="nav-link" data-scroll-target="#practical-example-analyzing-the-titanic-dataset-with-duckdb-and-kaggle-api">Practical Example: Analyzing the Titanic Dataset with DuckDB and Kaggle API</a>
  <ul class="collapse">
  <li><a href="#prerequisites-and-setup" id="toc-prerequisites-and-setup" class="nav-link" data-scroll-target="#prerequisites-and-setup">Prerequisites and Setup</a></li>
  <li><a href="#step-1-kaggle-api-configuration" id="toc-step-1-kaggle-api-configuration" class="nav-link" data-scroll-target="#step-1-kaggle-api-configuration">Step 1: Kaggle API Configuration</a></li>
  <li><a href="#step-2-advanced-data-analysis-with-duckdb" id="toc-step-2-advanced-data-analysis-with-duckdb" class="nav-link" data-scroll-target="#step-2-advanced-data-analysis-with-duckdb">Step 2: Advanced Data Analysis with DuckDB</a></li>
  <li><a href="#key-takeaways-from-this-example" id="toc-key-takeaways-from-this-example" class="nav-link" data-scroll-target="#key-takeaways-from-this-example">Key Takeaways from this Example</a></li>
  <li><a href="#cleanup" id="toc-cleanup" class="nav-link" data-scroll-target="#cleanup">Cleanup</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to DuckDB</h1>
  <div class="quarto-categories">
    <div class="quarto-category">DuckDB</div>
    <div class="quarto-category">Python</div>
    <div class="quarto-category">Data Science</div>
    <div class="quarto-category">Analytics</div>
  </div>
  </div>

<div>
  <div class="description">
    A comprehensive guide to DuckDB: an analytical database designed for seamless data analysis with Python
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://dannyvolkaerts.github.io/">Danny Volkaerts</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction-to-duckdb" class="level1">
<h1>Introduction to DuckDB</h1>
<p>This document provides a comprehensive overview of DuckDB, exploring its fundamental concepts, key strengths, and practical applications. We’ll demonstrate its capabilities through a detailed example using the Titanic dataset, imported directly from Kaggle using their API.</p>
<section id="what-is-duckdb" class="level2">
<h2 class="anchored" data-anchor-id="what-is-duckdb">What is DuckDB?</h2>
<p>DuckDB is a <strong>high-performance analytical database</strong> specifically engineered to operate seamlessly within your applications. By default, DuckDB operates with an <strong>in-memory database</strong> that maintains global state within the Python module when utilizing <code>duckdb.sql()</code>. This design choice means that no persistent tables are stored on disk unless explicitly configured otherwise.</p>
<p>However, DuckDB also provides the flexibility to establish connections with <strong>persistent databases</strong> by specifying a filename through <code>duckdb.connect(dbname)</code>. All data written to these connections remains persistent and can be reloaded by reconnecting to the same file, whether from Python or other DuckDB clients.</p>
<p>DuckDB demonstrates remarkable versatility through its support for an <strong>extensive range of Client APIs</strong>, including: * <strong>C</strong> - Low-level systems programming</p>
<ul>
<li><p><strong>C++</strong> - High-performance applications</p></li>
<li><p><strong>CLI</strong> (Command Line Interface) - Interactive database operations</p></li>
<li><p><strong>Dart</strong> - Mobile and web application development</p></li>
<li><p><strong>Go</strong> - Concurrent and scalable applications</p></li>
<li><p><strong>Java (JDBC)</strong> - Enterprise Java applications</p></li>
<li><p><strong>Julia</strong> - High-performance scientific computing</p></li>
<li><p><strong>Node.js</strong> - Server-side JavaScript applications</p></li>
<li><p><strong>ODBC</strong> - Universal database connectivity</p></li>
<li><p><strong>Python</strong> - Data science and analytics workflows</p></li>
<li><p><strong>R</strong> - Statistical computing and data analysis</p></li>
<li><p><strong>Rust</strong> - Systems programming with memory safety</p></li>
<li><p><strong>Swift</strong> - iOS and macOS applications</p></li>
<li><p><strong>WebAssembly (Wasm)</strong> - Browser-based applications</p></li>
</ul>
<p>The database engine provides comprehensive <strong>SQL functionality</strong>, encompassing essential statements such as <code>SELECT</code>, <code>INSERT</code>, <code>CREATE TABLE</code>, <code>ALTER TABLE</code>, <code>DELETE</code>, <code>UPDATE</code>, and <code>COPY</code>. It includes advanced query syntax capabilities, diverse data types (Array, Boolean, Date, Numeric, Text, Timestamp), sophisticated expressions, and an extensive collection of functions including Aggregate, Date, Numeric, Text, and Window Functions.</p>
</section>
<section id="what-makes-duckdb-exceptional" class="level2">
<h2 class="anchored" data-anchor-id="what-makes-duckdb-exceptional">What Makes DuckDB Exceptional?</h2>
<p>DuckDB’s distinctive strengths establish it as a powerful tool for data analysis and processing, particularly when integrated with Python ecosystems:</p>
<section id="comprehensive-data-ingestion-and-direct-querying-capabilities" class="level3">
<h3 class="anchored" data-anchor-id="comprehensive-data-ingestion-and-direct-querying-capabilities">Comprehensive Data Ingestion and Direct Querying Capabilities</h3>
<p>DuckDB excels in its ability to ingest data from a <strong>diverse array of formats</strong>, supporting both disk-based and in-memory operations. The database natively supports CSV, Parquet, and JSON file formats. One of its most compelling features is the capability to <strong>query these files directly using SQL</strong> as if they were traditional database tables. For instance, you can execute <code>SELECT * FROM 'example.csv'</code> without any preliminary data loading steps.</p>
</section>
<section id="seamless-integration-with-python-data-structures" class="level3">
<h3 class="anchored" data-anchor-id="seamless-integration-with-python-data-structures">Seamless Integration with Python Data Structures</h3>
<p>DuckDB provides <strong>native support for querying Pandas DataFrames, Polars DataFrames, and PyArrow tables</strong> directly. This integration represents a significant advantage, enabling analysts to leverage SQL queries on existing Python data structures without requiring conversion or loading into separate database systems. It’s important to note that these direct queries operate in <strong>read-only mode</strong>.</p>
</section>
<section id="efficient-result-conversion-and-interoperability" class="level3">
<h3 class="anchored" data-anchor-id="efficient-result-conversion-and-interoperability">Efficient Result Conversion and Interoperability</h3>
<p>Query results can be efficiently transformed into various Python objects and popular data formats. The system supports seamless conversion to Pandas DataFrames (<code>.df()</code>), Polars DataFrames (<code>.pl()</code>), Arrow Tables (<code>.arrow()</code>), and NumPy Arrays (<code>.fetchnumpy()</code>), facilitating smooth workflow integration across different data processing libraries.</p>
</section>
<section id="flexible-storage-architecture" class="level3">
<h3 class="anchored" data-anchor-id="flexible-storage-architecture">Flexible Storage Architecture</h3>
<p>DuckDB offers users the choice between <strong>in-memory databases</strong> for rapid, temporary analyses and <strong>persistent storage</strong> solutions for data preservation. This flexibility allows for optimal performance tuning based on specific use case requirements.</p>
</section>
<section id="advanced-data-export-capabilities" class="level3">
<h3 class="anchored" data-anchor-id="advanced-data-export-capabilities">Advanced Data Export Capabilities</h3>
<p>Query results (Relation objects) can be written directly to disk in formats such as Parquet and CSV, or you can utilize the SQL <code>COPY</code> statement for more complex export operations. This functionality streamlines data pipeline workflows.</p>
</section>
<section id="developer-friendly-api-design" class="level3">
<h3 class="anchored" data-anchor-id="developer-friendly-api-design">Developer-Friendly API Design</h3>
<p>The <code>duckdb</code> module and connection objects (<code>duckdb.connect()</code>) support identical methods, providing implementation flexibility. For package development, connection objects are recommended to prevent potential conflicts with shared global in-memory databases.</p>
</section>
<section id="extensible-architecture" class="level3">
<h3 class="anchored" data-anchor-id="extensible-architecture">Extensible Architecture</h3>
<p>DuckDB supports the <strong>installation and loading of extensions</strong>, such as the <code>spatial</code> extension for geospatial data analysis or <code>httpfs</code> for accessing HTTP(S) and S3-based files. The platform also supports <strong>community-developed extensions</strong> through the <code>repository="community"</code> parameter.</p>
</section>
<section id="optimized-query-execution" class="level3">
<h3 class="anchored" data-anchor-id="optimized-query-execution">Optimized Query Execution</h3>
<p>Queries return <strong>Relation objects</strong>, which serve as symbolic representations of the query. The actual execution occurs only when results are explicitly requested or displayed, contributing to overall system efficiency through lazy evaluation.</p>
</section>
</section>
<section id="practical-example-analyzing-the-titanic-dataset-with-duckdb-and-kaggle-api" class="level2">
<h2 class="anchored" data-anchor-id="practical-example-analyzing-the-titanic-dataset-with-duckdb-and-kaggle-api">Practical Example: Analyzing the Titanic Dataset with DuckDB and Kaggle API</h2>
<p>This comprehensive example demonstrates how to leverage DuckDB’s capabilities by importing the famous Titanic dataset directly from Kaggle using their API, then performing sophisticated data analysis using SQL queries.</p>
<section id="prerequisites-and-setup" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-and-setup">Prerequisites and Setup</h3>
<p>Before proceeding, ensure you have the following requirements:</p>
<ol type="1">
<li><strong>Python 3.9 or newer</strong> - DuckDB requires a modern Python version</li>
<li><strong>Kaggle API credentials</strong> - You’ll need a Kaggle account and API key</li>
<li><strong>Required packages</strong> - Install via <code>pip install duckdb kaggle pandas</code></li>
</ol>
</section>
<section id="step-1-kaggle-api-configuration" class="level3">
<h3 class="anchored" data-anchor-id="step-1-kaggle-api-configuration">Step 1: Kaggle API Configuration</h3>
<p>First, let’s set up the Kaggle API to download the Titanic dataset:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kaggle.api.kaggle_api_extended <span class="im">import</span> KaggleApi</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize and authenticate Kaggle API</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Make sure you have ~/.kaggle/kaggle.json with your credentials</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># or set KAGGLE_USERNAME and KAGGLE_KEY environment variables</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>api <span class="op">=</span> KaggleApi()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>api.authenticate()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the Titanic dataset from Kaggle</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Downloading Titanic dataset from Kaggle..."</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>api.competition_download_files(<span class="st">'titanic'</span>, path<span class="op">=</span><span class="st">'.'</span>, quiet<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the downloaded zip file</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zipfile.ZipFile(<span class="st">'titanic.zip'</span>, <span class="st">'r'</span>) <span class="im">as</span> zip_ref:</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    zip_ref.extractall(<span class="st">'.'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Dataset downloaded and extracted successfully!"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># List the extracted files</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>extracted_files <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="st">'.'</span>) <span class="cf">if</span> f.endswith(<span class="st">'.csv'</span>)]</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Available CSV files: </span><span class="sc">{</span>extracted_files<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-advanced-data-analysis-with-duckdb" class="level3">
<h3 class="anchored" data-anchor-id="step-2-advanced-data-analysis-with-duckdb">Step 2: Advanced Data Analysis with DuckDB</h3>
<p>Now let’s perform comprehensive analysis using DuckDB’s powerful SQL capabilities:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to DuckDB (in-memory database)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">':memory:'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"=== TITANIC DATASET ANALYSIS WITH DUCKDB ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Query 1: Basic dataset overview</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"1. Dataset Overview - First 5 rows:"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>overview_query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT * </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM 'train.csv' </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">    LIMIT 5</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> conn.execute(overview_query)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>result.df().head()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. Dataset Dimensions and Basic Statistics:"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>stats_query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(*) as total_passengers,</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(DISTINCT Pclass) as passenger_classes,</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(DISTINCT Sex) as gender_categories,</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(DISTINCT Embarked) as embarkation_ports,</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="st">        AVG(Age) as average_age,</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="st">        MIN(Age) as youngest_passenger,</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="st">        MAX(Age) as oldest_passenger,</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="st">        AVG(Fare) as average_fare</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM 'train.csv'</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>stats_result <span class="op">=</span> conn.execute(stats_query).df()</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stats_result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. Survival Analysis by Demographics:"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>survival_demographics <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="st">        Sex,</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="st">        Pclass,</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(*) as total_passengers,</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="st">        SUM(Survived) as survivors,</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Survived) * 100, 2) as survival_rate_percent,</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Age), 1) as avg_age,</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Fare), 2) as avg_fare</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM 'train.csv'</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE Age IS NOT NULL</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY Sex, Pclass</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY Sex, Pclass</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>demographics_result <span class="op">=</span> conn.execute(survival_demographics).df()</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(demographics_result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. Advanced Analysis: Survival by Age Groups:"</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>age_group_analysis <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="st">        CASE </span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Age &lt; 18 THEN 'Child (0-17)'</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Age &gt;= 18 AND Age &lt; 35 THEN 'Young Adult (18-34)'</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Age &gt;= 35 AND Age &lt; 55 THEN 'Middle Age (35-54)'</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Age &gt;= 55 THEN 'Senior (55+)'</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="st">            ELSE 'Unknown'</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="st">        END as age_group,</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(*) as total_passengers,</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="st">        SUM(Survived) as survivors,</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Survived) * 100, 2) as survival_rate_percent,</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Fare), 2) as avg_fare_paid</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM 'train.csv'</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE Age IS NOT NULL</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY age_group</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY </span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="st">        CASE </span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN age_group = 'Child (0-17)' THEN 1</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN age_group = 'Young Adult (18-34)' THEN 2</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN age_group = 'Middle Age (35-54)' THEN 3</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN age_group = 'Senior (55+)' THEN 4</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="st">            ELSE 5</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="st">        END</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>age_analysis_result <span class="op">=</span> conn.execute(age_group_analysis).df()</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(age_analysis_result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">5. Family Size Impact on Survival:"</span>)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>family_analysis <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="st">        (SibSp + Parch) as family_size,</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="st">        CASE </span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN (SibSp + Parch) = 0 THEN 'Alone'</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN (SibSp + Parch) BETWEEN 1 AND 3 THEN 'Small Family (1-3)'</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN (SibSp + Parch) BETWEEN 4 AND 6 THEN 'Medium Family (4-6)'</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="st">            ELSE 'Large Family (7+)'</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="st">        END as family_category,</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(*) as passenger_count,</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="st">        SUM(Survived) as survivors,</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Survived) * 100, 2) as survival_rate_percent</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM 'train.csv'</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY family_size, family_category</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY family_size</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>family_result <span class="op">=</span> conn.execute(family_analysis).df()</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(family_result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">6. Port of Embarkation Analysis:"</span>)</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>embarkation_analysis <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="st">        CASE </span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Embarked = 'C' THEN 'Cherbourg'</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Embarked = 'Q' THEN 'Queenstown'</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="st">            WHEN Embarked = 'S' THEN 'Southampton'</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="st">            ELSE 'Unknown'</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="st">        END as port_of_embarkation,</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="st">        COUNT(*) as passenger_count,</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="st">        SUM(Survived) as survivors,</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Survived) * 100, 2) as survival_rate_percent,</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Fare), 2) as avg_fare,</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="st">        ROUND(AVG(Age), 1) as avg_age</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM 'train.csv'</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE Embarked IS NOT NULL</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY Embarked, port_of_embarkation</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY survival_rate_percent DESC</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>embarkation_result <span class="op">=</span> conn.execute(embarkation_analysis).df()</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(embarkation_result.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate DuckDB's ability to export results</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">7. Exporting Analysis Results:"</span>)</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the demographic analysis to a new CSV file</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>conn.execute(<span class="st">"""</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="st">    COPY (</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a><span class="st">        SELECT </span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="st">            Sex,</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="st">            Pclass,</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="st">            COUNT(*) as total_passengers,</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="st">            SUM(Survived) as survivors,</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="st">            ROUND(AVG(Survived) * 100, 2) as survival_rate_percent</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="st">        FROM 'train.csv'</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="st">        GROUP BY Sex, Pclass</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="st">        ORDER BY Sex, Pclass</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="st">    ) TO 'titanic_survival_analysis.csv' (HEADER, DELIMITER ',')</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Results exported to 'titanic_survival_analysis.csv'"</span>)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate conversion to different Python data structures</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">8. Converting Results to Different Data Structures:"</span>)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>sample_result <span class="op">=</span> conn.execute(<span class="st">"SELECT * FROM 'train.csv' LIMIT 3"</span>)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Pandas DataFrame</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>pandas_df <span class="op">=</span> sample_result.df()</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pandas DataFrame shape: </span><span class="sc">{</span>pandas_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Arrow Table</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>arrow_table <span class="op">=</span> sample_result.arrow()</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Arrow Table schema: </span><span class="sc">{</span>arrow_table<span class="sc">.</span>schema<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to NumPy array (for numerical columns only)</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>numeric_result <span class="op">=</span> conn.execute(<span class="st">"SELECT Age, Fare FROM 'train.csv' WHERE Age IS NOT NULL LIMIT 5"</span>)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>numpy_array <span class="op">=</span> numeric_result.fetchnumpy()</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NumPy arrays: </span><span class="sc">{</span><span class="bu">list</span>(numpy_array.keys())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the connection</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>conn.close()</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Analysis complete! DuckDB connection closed."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="key-takeaways-from-this-example" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaways-from-this-example">Key Takeaways from this Example</h3>
<p>This example demonstrates several powerful DuckDB features:</p>
<ol type="1">
<li><strong>Direct CSV querying</strong> without loading data into memory first</li>
<li><strong>Complex SQL analytics</strong> with window functions and case statements</li>
<li><strong>Efficient data type handling</strong> and NULL value management</li>
<li><strong>Seamless integration</strong> with Python data science ecosystem</li>
<li><strong>Multiple export formats</strong> and data structure conversions</li>
<li><strong>Performance optimization</strong> through lazy evaluation</li>
</ol>
<p>The combination of Kaggle’s API and DuckDB’s analytical capabilities showcases how modern data science workflows can be streamlined and made more efficient. DuckDB’s SQL-first approach allows for complex analytical queries while maintaining the flexibility to integrate with existing Python data science libraries.</p>
</section>
<section id="cleanup" class="level3">
<h3 class="anchored" data-anchor-id="cleanup">Cleanup</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up downloaded files (optional)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>files_to_remove <span class="op">=</span> [<span class="st">'titanic.zip'</span>, <span class="st">'train.csv'</span>, <span class="st">'test.csv'</span>, <span class="st">'gender_submission.csv'</span>, <span class="st">'titanic_survival_analysis.csv'</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files_to_remove:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(<span class="bu">file</span>):</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        os.remove(<span class="bu">file</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Removed: </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This comprehensive example illustrates how DuckDB can serve as a powerful analytical engine for data science workflows, combining the familiarity of SQL with the flexibility of Python data processing libraries.</p>


</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{volkaerts2025,
  author = {Volkaerts, Danny},
  title = {Introduction to {DuckDB}},
  date = {2025-05-07},
  url = {https://dannyvolkaerts.github.io/posts/2022-10-24-my-blog-post/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-volkaerts2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Volkaerts, Danny. 2025. <span>“Introduction to DuckDB.”</span> May 7,
2025. <a href="https://dannyvolkaerts.github.io/posts/2022-10-24-my-blog-post/">https://dannyvolkaerts.github.io/posts/2022-10-24-my-blog-post/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>